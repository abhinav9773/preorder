"use client";
// src/components/Preorder/Sections.tsx

import { useState } from "react";
import { FAQS, PLEDGE_LINES } from "@/lib/preorderData";
import { ActivityEntry, CohortsData, CohortDog, timeAgo } from "@/lib/api";

export function SavingsSection() {
  return null;
}

/* â”€â”€ Pet Wall â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const COHORT_SIZE = 20;

function CircleGrid({
  dogs,
  onClaim,
}: {
  dogs: CohortDog[];
  onClaim?: () => void;
}) {
  const nextPosition = dogs.length + 1;

  return (
    <div className="flex flex-wrap gap-3 sm:gap-4 mt-8 sm:mt-10">
      {Array.from({ length: COHORT_SIZE }, (_, i) => {
        const position = i + 1;
        const dog = dogs.find((d) => d.position === position);
        const isTaken = !!dog;
        const isYours = position === nextPosition && !isTaken;
        const initials = dog?.dogName
          ? dog.dogName.slice(0, 2).toUpperCase()
          : null;

        return (
          <div key={i} className="group relative">
            <div
              onClick={isYours ? onClaim : undefined}
              className={`
                w-[72px] h-[72px] sm:w-[88px] sm:h-[88px] rounded-full
                flex items-center justify-center transition-all duration-300
                ${
                  isTaken
                    ? "bg-[#2a1508] border-2 border-[#E8622A]/70"
                    : isYours
                      ? "bg-transparent border-2 border-dashed border-[#E8622A]/50 po-spot-pulse cursor-pointer hover:border-[#E8622A]"
                      : "bg-transparent border border-dashed border-white/[0.1]"
                }
              `}
            >
              {isTaken ? (
                dog?.dogPhoto ? (
                  <img
                    src={dog.dogPhoto}
                    alt={dog.dogName}
                    className="w-full h-full rounded-full object-cover"
                  />
                ) : (
                  <span className="font-playfair text-[#E8622A] font-normal text-[16px] sm:text-[18px]">
                    {initials}
                  </span>
                )
              ) : isYours ? (
                <span className="font-playfair text-[#E8622A]/60 text-[12px] sm:text-[13px] font-normal">
                  You?
                </span>
              ) : (
                <span className="text-[10px] sm:text-[12px] text-white/15 font-light">
                  #{position}
                </span>
              )}
            </div>

            {isTaken && (
              <div className="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 bg-[#1a1a1a] border border-white/[0.07] rounded-lg px-3 py-2 text-[11px] text-white/60 whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-20">
                <span className="text-[#E8622A]">{dog?.dogName}</span> Â· #
                {position}
              </div>
            )}
          </div>
        );
      })}
    </div>
  );
}

export function PetWall({
  cohorts,
  onClaim,
}: {
  cohorts: CohortsData;
  onClaim?: () => void;
}) {
  const [activeCohort, setActiveCohort] = useState(0);
  const cohort1Dogs = cohorts["cohort 1"] ?? [];
  const cohort2Dogs = cohorts["cohort 2"] ?? [];
  const cohort1Full = cohort1Dogs.length >= COHORT_SIZE;

  return (
    <section
      id="wall"
      className="bg-[#0a0a0a] py-20 sm:py-28 px-6 sm:px-10 md:px-20 border-t border-white/[0.04]"
    >
      <div className="max-w-[1100px] mx-auto">
        <p className="text-[10px] font-semibold tracking-[4px] uppercase text-white/20 mb-6 sm:mb-8">
          004 â€” The Pack
        </p>
        <h2
          className="font-playfair font-normal text-white leading-[1.08] mb-4 sm:mb-5"
          style={{ fontSize: "clamp(32px, 4.5vw, 64px)" }}
        >
          20 spots.
          <br />
          That's it.
        </h2>
        <p className="text-[13px] sm:text-[14px] text-white/30 font-light leading-[1.9] max-w-[380px] mb-4">
          Every circle below is a founding member. The orange ones are taken.
          The pulsing one is yours.
        </p>

        {/* Cohort tabs */}
        <div className="flex gap-6 mt-8 sm:mt-10 border-b border-white/[0.06]">
          {[
            { label: "Cohort 1", dogs: cohort1Dogs, locked: false },
            { label: "Cohort 2", dogs: cohort2Dogs, locked: !cohort1Full },
          ].map((c, idx) => (
            <button
              key={idx}
              onClick={() => !c.locked && setActiveCohort(idx)}
              disabled={c.locked}
              className={`pb-3 text-[12px] font-semibold tracking-wide transition-colors border-b-2 -mb-[1px] ${
                c.locked
                  ? "text-white/15 cursor-not-allowed border-transparent"
                  : activeCohort === idx
                    ? "text-white border-[#E8622A]"
                    : "text-white/30 border-transparent hover:text-white/55"
              }`}
            >
              {c.label} {c.locked && "ðŸ”’"}
              {!c.locked && (
                <span className="ml-2 text-[10px] text-white/20 font-light">
                  {c.dogs.length}/{COHORT_SIZE}
                </span>
              )}
            </button>
          ))}
        </div>

        <CircleGrid
          dogs={activeCohort === 0 ? cohort1Dogs : cohort2Dogs}
          onClaim={onClaim}
        />
      </div>
    </section>
  );
}

export function FeedSection({
  activity,
  onClaim,
}: {
  activity: ActivityEntry[];
  onClaim: () => void;
}) {
  return null;
}

/* â”€â”€ Steps â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
export function StepsSection() {
  const steps = [
    {
      n: "01",
      title: "Reserve your spot",
      desc: "A refundable â‚¹500 deposit holds your place in the Founding Pack. No risk. Fully cancellable until dispatch.",
    },
    {
      n: "02",
      title: "We build, you wait",
      desc: "Your collar is assembled and tested through April 2026. We keep you updated â€” you'll know exactly where it is at every stage.",
    },
    {
      n: "03",
      title: "Collar ships first",
      desc: "Founding Pack orders dispatch before all others. Your dog is the first in their city wearing it.",
    },
    {
      n: "04",
      title: "You never stop knowing",
      desc: "Real-time GPS. Intelligent alerts. A calm, assured feeling that â€” wherever they wander â€” you'll always know.",
    },
  ];

  return (
    <section
      id="process"
      className="bg-[#0a0a0a] py-20 sm:py-28 px-6 sm:px-10 md:px-20 border-t border-white/[0.04]"
    >
      <div className="max-w-[1100px] mx-auto">
        <p className="text-[10px] font-semibold tracking-[4px] uppercase text-white/20 mb-6 sm:mb-8">
          005 â€” How it works
        </p>
        <h2
          className="font-playfair font-normal text-white leading-[1.08] mb-14 sm:mb-20"
          style={{ fontSize: "clamp(32px, 4.5vw, 64px)" }}
        >
          Simple by design.
        </h2>

        <div className="flex flex-col">
          {steps.map((s, i) => (
            <div
              key={s.n}
              className={`flex items-start gap-8 sm:gap-12 py-10 sm:py-12 ${
                i < steps.length - 1 ? "border-b border-white/[0.05]" : ""
              }`}
            >
              <span
                className="font-playfair text-[#E8622A] leading-none shrink-0 w-[56px] sm:w-[80px]"
                style={{ fontSize: "clamp(32px, 4vw, 60px)" }}
              >
                {s.n}
              </span>
              <div className="pt-1">
                <h3
                  className="font-playfair font-normal text-white mb-3 leading-[1.2]"
                  style={{ fontSize: "clamp(18px, 2vw, 26px)" }}
                >
                  {s.title}
                </h3>
                <p className="text-[13px] sm:text-[14px] text-white/30 font-light leading-[1.85] max-w-[560px]">
                  {s.desc}
                </p>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  );
}

export function PledgeSection() {
  return null;
}

/* â”€â”€ FAQ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  */
function FaqItem({ q, a }: { q: string; a: string }) {
  const [open, setOpen] = useState(false);
  return (
    <div
      className="border-b border-white/[0.05] py-6 sm:py-7 cursor-pointer group"
      onClick={() => setOpen(!open)}
    >
      <div className="flex justify-between items-start gap-4 sm:gap-6">
        <span
          className="font-playfair font-normal text-white/55 group-hover:text-white/85 transition-colors leading-[1.4]"
          style={{ fontSize: "clamp(14px, 1.5vw, 18px)" }}
        >
          {q}
        </span>
        <span
          className={`text-[#E8622A] text-[20px] sm:text-[22px] shrink-0 transition-transform duration-200 mt-[1px] ${
            open ? "rotate-45" : ""
          }`}
        >
          +
        </span>
      </div>
      {open && (
        <p className="text-[13px] text-white/30 font-light leading-[1.9] mt-4 max-w-[640px]">
          {a}
        </p>
      )}
    </div>
  );
}

export function FaqSection() {
  return (
    <section className="bg-[#0a0a0a] py-20 sm:py-28 px-6 sm:px-10 md:px-20 border-t border-white/[0.04]">
      <div className="max-w-[1100px] mx-auto">
        <div className="grid grid-cols-1 md:grid-cols-[280px_1fr] gap-10 sm:gap-16 md:gap-20">
          <div>
            <h2
              className="font-playfair font-normal text-white leading-[1.1]"
              style={{ fontSize: "clamp(26px, 3vw, 42px)" }}
            >
              Anything on
              <br />
              your mind?
            </h2>
          </div>
          <div className="border-t border-white/[0.05]">
            {FAQS.map((f) => (
              <FaqItem key={f.q} q={f.q} a={f.a} />
            ))}
          </div>
        </div>
      </div>
    </section>
  );
}

/* â”€â”€ Final CTA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  */
export function FinalCTA({
  remaining,
  onClaim,
}: {
  remaining: number;
  onClaim: () => void;
}) {
  return (
    <>
      {/* Pledge */}
      <section className="bg-[#0a0a0a] py-20 sm:py-24 px-6 sm:px-10 md:px-20 border-t border-white/[0.04]">
        <div className="max-w-[1100px] mx-auto grid grid-cols-1 md:grid-cols-2 gap-10 sm:gap-16 items-center">
          <h2
            className="font-playfair font-normal text-white leading-[1.1]"
            style={{ fontSize: "clamp(24px, 3vw, 40px)" }}
          >
            We built MyPerro because
            <br />
            <span className="text-white/30">our own pet got lost once.</span>
          </h2>
          <ul className="flex flex-col gap-4">
            {[
              "We will never sell your pet's data to advertisers, ever",
              "If we don't ship, every rupee is refunded â€” no questions asked",
              "Founding Pack members keep their perks forever, even post-launch",
              "We will share real updates â€” delays included. No radio silence",
              "Your pet's safety is the only thing we optimise for",
            ].map((line) => (
              <li
                key={line}
                className="flex items-start gap-3 text-[13px] text-white/35 font-light leading-[1.7]"
              >
                <span className="text-[#E8622A] shrink-0 mt-[2px]">â€”</span>
                {line}
              </li>
            ))}
          </ul>
        </div>
      </section>

      {/* Reserve */}
      <section
        id="reserve"
        className="bg-[#0a0a0a] py-20 sm:py-28 px-6 sm:px-10 md:px-20 border-t border-white/[0.04] text-center"
      >
        <div className="max-w-[760px] mx-auto">
          <h2
            className="font-playfair font-normal text-white leading-[1.05] mb-4 sm:mb-5"
            style={{ fontSize: "clamp(38px, 6vw, 84px)" }}
          >
            Twenty collars.
            <br />
            Twenty dogs.
            <br />
            <em className="text-[#E8622A]" style={{ fontStyle: "italic" }}>
              Your dog.
            </em>
          </h2>

          <p className="text-[13px] sm:text-[14px] text-white/25 font-light mb-10 sm:mb-14">
            The Founding Pack closes when the last spot is taken.
          </p>

          <div className="bg-[#111] border border-white/[0.06] rounded-2xl px-8 sm:px-10 py-12 sm:py-14 max-w-[500px] mx-auto">
            <p
              className="font-playfair font-normal text-white mb-2"
              style={{ fontSize: "clamp(36px, 5vw, 60px)" }}
            >
              â‚¹500
            </p>
            <p className="text-[11px] font-semibold tracking-[3px] uppercase text-white/20 mb-8 sm:mb-10">
              Refundable Reservation Deposit
            </p>
            <button
              onClick={onClaim}
              className="w-full bg-[#E8622A] text-white font-semibold text-[14px] sm:text-[15px] py-[15px] sm:py-[16px] rounded-full transition-opacity hover:opacity-90"
            >
              Join the Founding Pack â†’
            </button>
            <p className="text-[11px] sm:text-[12px] text-white/20 font-light mt-5 sm:mt-6 leading-[1.8]">
              Fully refundable Â· No commitment Â· Cancel anytime before dispatch
            </p>
          </div>
        </div>
      </section>
    </>
  );
}
